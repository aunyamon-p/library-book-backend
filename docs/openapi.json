{
  "openapi": "3.0.3",
  "info": {
    "title": "Library Book Backend API",
    "version": "1.0.0",
    "description": "API สำหรับระบบจัดการห้องสมุด (Admin, หนังสือ, สมาชิก, การยืม และสถิติ)"
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Local server"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    { "name": "Auth" },
    { "name": "Books" },
    { "name": "Members" },
    { "name": "Admins" },
    { "name": "Borrow" },
    { "name": "Dashboard" },
    { "name": "Categories" },
    { "name": "Returns" },
    { "name": "ReturnDetails" }
  ],
  "paths": {
    "/api/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "เข้าสู่ระบบผู้ดูแล",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AuthLoginRequest" },
              "example": { "username": "admin", "password": "password123" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "เข้าสู่ระบบสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AuthLoginResponse" }
              }
            }
          },
          "400": { "description": "ขาด username หรือ password" },
          "401": { "description": "ข้อมูลเข้าสู่ระบบไม่ถูกต้อง" }
        }
      }
    },
    "/api/books": {
      "get": {
        "tags": ["Books"],
        "summary": "รายการหนังสือทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Book" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Books"],
        "summary": "เพิ่มหนังสือ",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BookInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "เพิ่มหนังสือสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      }
    },
    "/api/books/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["Books"],
        "summary": "แก้ไขข้อมูลหนังสือ",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BookInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตหนังสือสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Books"],
        "summary": "ลบหนังสือ",
        "responses": {
          "200": {
            "description": "ลบหนังสือสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      }
    },
    "/api/members": {
      "get": {
        "tags": ["Members"],
        "summary": "รายการสมาชิกทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Member" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Members"],
        "summary": "เพิ่มสมาชิก",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/MemberInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "เพิ่มสมาชิกสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Member" }
              }
            }
          }
        }
      }
    },
    "/api/members/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["Members"],
        "summary": "แก้ไขข้อมูลสมาชิก",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/MemberInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตสมาชิกสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Member" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Members"],
        "summary": "ลบสมาชิก",
        "responses": {
          "200": {
            "description": "ลบสมาชิกสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      }
    },
    "/api/categories": {
      "get": {
        "tags": ["Categories"],
        "summary": "รายการหมวดหมู่ทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Category" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Categories"],
        "summary": "เพิ่มหมวดหมู่",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CategoryInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "เพิ่มหมวดหมู่สำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Category" }
              }
            }
          }
        }
      }
    },
    "/api/categories/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["Categories"],
        "summary": "แก้ไขชื่อหมวดหมู่",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CategoryInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตหมวดหมู่สำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Category" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Categories"],
        "summary": "ลบหมวดหมู่",
        "responses": {
          "200": {
            "description": "ลบหมวดหมู่สำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          },
          "404": { "description": "ไม่พบหมวดหมู่" }
        }
      }
    },
    "/api/admin": {
      "get": {
        "tags": ["Admins"],
        "summary": "รายการผู้ดูแลทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Admin" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Admins"],
        "summary": "เพิ่มผู้ดูแล",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AdminInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "เพิ่มผู้ดูแลสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Admin" }
              }
            }
          }
        }
      }
    },
    "/api/admin/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["Admins"],
        "summary": "แก้ไขข้อมูลผู้ดูแล",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AdminInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตผู้ดูแลสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Admin" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Admins"],
        "summary": "ลบผู้ดูแล",
        "responses": {
          "200": {
            "description": "ลบผู้ดูแลสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      }
    },
    "/api/borrow": {
      "get": {
        "tags": ["Borrow"],
        "summary": "ประวัติการยืมทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/BorrowRecord" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Borrow"],
        "summary": "สร้างรายการยืม",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BorrowCreateRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "สร้างรายการยืมสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BorrowCreateResponse" }
              }
            }
          }
        }
      }
    },
    "/api/borrow/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["Borrow"],
        "summary": "อัปเดตสถานะหนังสือในรายการยืม",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BorrowStatusUpdateRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตสถานะสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/DetailBorrow" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Borrow"],
        "summary": "ลบรายการยืม",
        "responses": {
          "200": {
            "description": "ลบรายการยืมสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      }
    },
    "/api/dashboard": {
      "get": {
        "tags": ["Dashboard"],
        "summary": "สถิติแดชบอร์ด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/DashboardStats" }
              }
            }
          }
        }
      }
    },
    "/api/returns": {
      "get": {
        "tags": ["Returns"],
        "summary": "รายการคืนหนังสือทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ReturnRecord" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Returns"],
        "summary": "สร้างรายการคืนหนังสือ",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ReturnInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "สร้างรายการคืนสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ReturnRecord" }
              }
            }
          }
        }
      }
    },
    "/api/returns/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["Returns"],
        "summary": "อัปเดตรายการคืนหนังสือ",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ReturnInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตรายการคืนสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ReturnRecord" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Returns"],
        "summary": "ลบรายการคืนหนังสือ",
        "responses": {
          "200": {
            "description": "ลบรายการคืนสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          },
          "404": { "description": "ไม่พบรายการคืน" }
        }
      }
    },
    "/api/return-details": {
      "get": {
        "tags": ["ReturnDetails"],
        "summary": "รายละเอียดการคืนทั้งหมด",
        "responses": {
          "200": {
            "description": "ดึงข้อมูลสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ReturnDetail" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["ReturnDetails"],
        "summary": "เพิ่มรายละเอียดการคืน",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ReturnDetailInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "เพิ่มรายละเอียดการคืนสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ReturnDetail" }
              }
            }
          }
        }
      }
    },
    "/api/return-details/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" }
        }
      ],
      "put": {
        "tags": ["ReturnDetails"],
        "summary": "แก้ไขรายละเอียดการคืน",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ReturnDetailInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "อัปเดตรายละเอียดการคืนสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ReturnDetail" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["ReturnDetails"],
        "summary": "ลบรายละเอียดการคืน",
        "responses": {
          "200": {
            "description": "ลบรายละเอียดการคืนสำเร็จ",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          },
          "404": { "description": "ไม่พบรายละเอียดการคืน" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "AuthLoginRequest": {
        "type": "object",
        "required": ["username", "password"],
        "properties": {
          "username": { "type": "string" },
          "password": { "type": "string" }
        }
      },
      "AuthLoginResponse": {
        "type": "object",
        "properties": {
          "token": { "type": "string" },
          "user": { "$ref": "#/components/schemas/Admin" }
        }
      },
      "MessageResponse": {
        "type": "object",
        "properties": {
          "message": { "type": "string" }
        }
      },
      "Admin": {
        "type": "object",
        "properties": {
          "admin_id": { "type": "integer" },
          "username": { "type": "string" },
          "password": { "type": "string" },
          "first_name": { "type": "string" },
          "last_name": { "type": "string" },
          "name": { "type": "string" }
        }
      },
      "AdminInput": {
        "type": "object",
        "required": ["username", "password", "first_name", "last_name", "name"],
        "properties": {
          "username": { "type": "string" },
          "password": { "type": "string" },
          "first_name": { "type": "string" },
          "last_name": { "type": "string" },
          "name": { "type": "string" }
        }
      },
      "Book": {
        "type": "object",
        "properties": {
          "book_id": { "type": "integer" },
          "isbn": { "type": "string" },
          "book_name": { "type": "string" },
          "author": { "type": "string" },
          "publisher": { "type": "string" },
          "publish_year": { "type": "integer" },
          "shelf": { "type": "string" },
          "amount": { "type": "integer" },
          "status": { "type": "string", "description": "available | borrowed" },
          "category_id": { "type": "integer" },
          "category_name": { "type": "string" }
        }
      },
      "BookInput": {
        "type": "object",
        "required": ["isbn", "book_name", "author", "publisher", "publish_year", "shelf", "amount", "status", "category_id"],
        "properties": {
          "isbn": { "type": "string" },
          "book_name": { "type": "string" },
          "author": { "type": "string" },
          "publisher": { "type": "string" },
          "publish_year": { "type": "integer" },
          "shelf": { "type": "string" },
          "amount": { "type": "integer" },
          "status": { "type": "string", "description": "available | borrowed" },
          "category_id": { "type": "integer" }
        }
      },
      "Category": {
        "type": "object",
        "properties": {
          "category_id": { "type": "integer" },
          "category_name": { "type": "string" }
        }
      },
      "CategoryInput": {
        "type": "object",
        "required": ["category_name"],
        "properties": {
          "category_name": { "type": "string" }
        }
      },
      "Member": {
        "type": "object",
        "properties": {
          "user_id": { "type": "integer" },
          "name": { "type": "string" },
          "first_name": { "type": "string" },
          "last_name": { "type": "string" },
          "email": { "type": "string" },
          "phone": { "type": "string" },
          "borrowlimit": { "type": "integer" },
          "date_registered": { "type": "string", "format": "date-time" },
          "status": { "type": "string" }
        }
      },
      "MemberInput": {
        "type": "object",
        "required": ["name", "first_name", "last_name", "email", "phone", "borrowlimit", "date_registered", "status"],
        "properties": {
          "name": { "type": "string" },
          "first_name": { "type": "string" },
          "last_name": { "type": "string" },
          "email": { "type": "string" },
          "phone": { "type": "string" },
          "borrowlimit": { "type": "integer" },
          "date_registered": { "type": "string", "format": "date-time" },
          "status": { "type": "string" }
        }
      },
      "BorrowRecord": {
        "type": "object",
        "properties": {
          "borrow_id": { "type": "integer" },
          "user_id": { "type": "integer" },
          "member_name": { "type": "string" },
          "borrow_date": { "type": "string", "format": "date-time" },
          "amount": { "type": "integer" },
          "recorded_by": { "type": "integer" },
          "books": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/DetailBorrow" }
          }
        }
      },
      "BorrowCreateRequest": {
        "type": "object",
        "required": ["user_id", "borrow_date", "amount", "recorded_by", "books"],
        "properties": {
          "user_id": { "type": "integer" },
          "borrow_date": { "type": "string", "format": "date-time" },
          "amount": { "type": "integer" },
          "recorded_by": { "type": "integer" },
          "books": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["book_id", "due_date"],
              "properties": {
                "book_id": { "type": "integer" },
                "due_date": { "type": "string", "format": "date-time" }
              }
            }
          }
        }
      },
      "BorrowCreateResponse": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "borrow_id": { "type": "integer" }
        }
      },
      "BorrowStatusUpdateRequest": {
        "type": "object",
        "required": ["book_id", "status"],
        "properties": {
          "book_id": { "type": "integer", "description": "book_id ในรายการยืม (PK ร่วมกับ borrow_id)" },
          "status": { "type": "string", "description": "borrowed | returned" }
        }
      },
      "DetailBorrow": {
        "type": "object",
        "properties": {
          "borrow_id": { "type": "integer" },
          "book_id": { "type": "integer" },
          "book_name": { "type": "string" },
          "due_date": { "type": "string", "format": "date-time" },
          "status": { "type": "string" }
        }
      },
      "DashboardStats": {
        "type": "object",
        "properties": {
          "totalBooks": { "type": "integer" },
          "totalMembers": { "type": "integer" },
          "borrowedBooks": { "type": "integer" },
          "overdueBooks": { "type": "integer" }
        }
      },
      "ReturnRecord": {
        "type": "object",
        "properties": {
          "return_id": { "type": "integer" },
          "return_date": { "type": "string", "format": "date-time" },
          "totalfine": { "type": "number", "format": "float" },
          "processed_by": { "type": "integer" }
        }
      },
      "ReturnInput": {
        "type": "object",
        "required": ["return_date", "processed_by"],
        "properties": {
          "return_date": { "type": "string", "format": "date-time" },
          "totalfine": { "type": "number", "format": "float", "description": "ถ้าใส่ items ระบบจะคำนวณจาก fine รวม" },
          "processed_by": { "type": "integer" },
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ReturnDetailInput" },
            "description": "รายการหนังสือที่คืน"
          }
        }
      },
      "ReturnDetail": {
        "type": "object",
        "properties": {
          "detail_returned_id": { "type": "integer" },
          "return_id": { "type": "integer" },
          "borrow_id": { "type": "integer" },
          "book_id": { "type": "integer" },
          "return_date": { "type": "string", "format": "date-time" },
          "fine": { "type": "number", "format": "float" },
          "status": { "type": "string" }
        }
      },
      "ReturnDetailInput": {
        "type": "object",
        "required": ["return_id", "borrow_id", "book_id", "return_date", "fine", "status"],
        "properties": {
          "return_id": { "type": "integer" },
          "borrow_id": { "type": "integer" },
          "book_id": { "type": "integer" },
          "return_date": { "type": "string", "format": "date-time" },
          "fine": { "type": "number", "format": "float" },
          "status": { "type": "string" }
        }
      }
    }
  }
}
